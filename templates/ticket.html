{% extends 'base.html' %}
{% block content %}
<div class="card">
  <h2 style="margin-top:0">Ticket {{ ticket.ticket_number }} (ID {{ ticket.id }})</h2>
  <p>
    Guild: {{ ticket.guild_id }} | Channel: {{ ticket.channel_id }} | Opener: {{ ticket.opener_id }}<br>
    Status: {{ ticket.status }} | Priority: {{ ticket.priority }}
  </p>
  <p>
    Created: {{ ticket.created_at }}
    {% if ticket.closed_at %} | Closed: {{ ticket.closed_at }}{% endif %}
  </p>
  <p><a class="btn" href="/ticket/{{ ticket.id }}/export.json">Export JSON</a></p>
</div>

<div class="card">
  <h3 style="margin-top:0">Messages</h3>
  {% if messages and messages|length > 0 %}
  <table>
    <thead><tr><th>Time</th><th>Author</th><th>Discord Message ID</th><th>Content</th></tr></thead>
    <tbody>
      {% for m in messages %}
      <tr>
        <td>{{ m.created_at }}</td>
        <td>{{ m.author_id }}</td>
        <td>{{ m.discord_message_id or '' }}</td>
        <td>
          {% if m.attachments_json and m.attachments_json != '[]' %}
            <div><small>Attachments: {{ m.attachments_json }}</small></div>
          {% endif %}
          <pre style="white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; background:#0b1220; padding:8px; border-radius:6px;">{{ m.content }}</pre>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>No messages.</p>
  {% endif %}
  <p><a href="/guild/{{ ticket.guild_id }}/tickets">Back to tickets</a></p>
</div>
{% endblock %}

